<div class="container">
  <div class="d-flex align-items-center mb-4">
    <a href="/admin/projects" class="btn btn-outline-primary me-3"><i class="bi bi-arrow-left"></i></a>
    <div class="flex-grow-1">
      <h1 class="mb-0">{{project.name}}</h1>
      <p class="text-muted mb-0">Project Details & Assessments</p>
    </div>
    <a href="/admin/projects/{{project.id}}/assessments/new" class="btn btn-primary">
      <i class="bi bi-plus-lg me-1"></i>New Assessment
    </a>
    <form action="/admin/projects/{{project.id}}/delete" method="POST" class="d-inline ms-2"
      onsubmit="return confirm('Delete this project and all its draft assessments? This cannot be undone.')">
      <button type="submit" class="btn btn-outline-danger">
        <i class="bi bi-trash me-1"></i>Delete Project
      </button>
    </form>
  </div>

  <div class="row g-4">
    <!-- Project Info -->
    <div class="col-lg-5">
      <div class="card">
        <div class="card-header"><i class="bi bi-info-circle me-2"></i>Project Information</div>
        <div class="card-body">
          <table class="table table-borderless mb-0">
            <tr>
              <td class="fw-semibold text-muted" style="width:40%">Classification</td>
              <td><span class="badge bg-info">{{project.data_classification}}</span></td>
            </tr>
            <tr>
              <td class="fw-semibold text-muted">Hosting</td>
              <td>{{project.hosting_type}}</td>
            </tr>
            <tr>
              <td class="fw-semibold text-muted">App Type</td>
              <td>{{project.app_type}}</td>
            </tr>
            <tr>
              <td class="fw-semibold text-muted">PII</td>
              <td>
                {{#if project.has_pii}}
                  <span class="badge bg-warning"><i class="bi bi-person-badge me-1"></i>Yes</span>
                {{else}}
                  <span class="badge bg-secondary">No</span>
                {{/if}}
              </td>
            </tr>
            <tr>
              <td class="fw-semibold text-muted">Status</td>
              <td>{{{statusBadge project.status}}}</td>
            </tr>
            <tr>
              <td class="fw-semibold text-muted">Created</td>
              <td>{{formatDate project.created_at}}</td>
            </tr>
          </table>

          {{#if project.description}}
            <hr>
            <h6 class="fw-semibold text-muted mb-2">Description</h6>
            <p class="small mb-0">{{project.description}}</p>
          {{/if}}

          {{#if techNames.length}}
            <hr>
            <h6 class="fw-semibold text-muted mb-2">Technology Stack</h6>
            <div class="d-flex flex-wrap gap-1">
              {{#each techNames}}
                <span class="badge bg-light text-dark border">{{this}}</span>
              {{/each}}
            </div>
          {{/if}}
        </div>
      </div>

      <!-- Contacts -->
      <div class="card mt-3">
        <div class="card-header bg-light"><i class="bi bi-people me-2"></i>Key Contacts</div>
        <div class="card-body">
          {{#if project.project_owner_name}}
            <div class="mb-3">
              <div class="small text-muted text-uppercase fw-bold">Project Owner / Architect</div>
              <div class="fw-semibold">{{project.project_owner_name}}</div>
              {{#if project.project_owner_email}}<div class="small text-muted">{{project.project_owner_email}}</div>{{/if}}
            </div>
          {{/if}}
          {{#if project.project_authority_name}}
            <div class="mb-3">
              <div class="small text-muted text-uppercase fw-bold">Project Authority</div>
              <div class="fw-semibold">{{project.project_authority_name}}</div>
              {{#if project.project_authority_email}}<div class="small text-muted">{{project.project_authority_email}}</div>{{/if}}
            </div>
          {{/if}}
          {{#if project.cio_name}}
            <div>
              <div class="small text-muted text-uppercase fw-bold">CIO / Delegated Authority</div>
              <div class="fw-semibold">{{project.cio_name}}</div>
              {{#if project.cio_email}}<div class="small text-muted">{{project.cio_email}}</div>{{/if}}
            </div>
          {{/if}}
        </div>
      </div>
    </div>

    <!-- Assessments -->
    <div class="col-lg-7">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <span><i class="bi bi-clipboard-check me-2"></i>Assessments</span>
          <a href="/admin/projects/{{project.id}}/assessments/new" class="btn btn-sm btn-outline-light">
            <i class="bi bi-plus-lg me-1"></i>Create
          </a>
        </div>
        <div class="card-body p-0">
          {{#if assessments.length}}
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead>
                  <tr>
                    <th>Type</th>
                    <th>Status</th>
                    <th>Score</th>
                    <th>Result</th>
                    <th>Invite Code</th>
                    <th>Updated</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  {{#each assessments}}
                    <tr>
                      <td class="fw-semibold text-capitalize">{{this.type}}</td>
                      <td>{{{statusBadge this.status}}}</td>
                      <td>
                        {{#if this.overall_score}}
                          <span class="fw-bold">{{this.overall_score}}%</span>
                        {{else}}
                          <span class="text-muted">—</span>
                        {{/if}}
                      </td>
                      <td>
                        {{#if this.result}}{{{statusBadge this.result}}}{{else}}<span class="text-muted">—</span>{{/if}}
                      </td>
                      <td><code class="small">{{this.invite_code}}</code></td>
                      <td class="small text-muted">{{formatDate this.updated_at}}</td>
                      <td class="text-end text-nowrap">
                        <a href="/admin/assessments/{{this.id}}" class="btn btn-sm btn-outline-primary">
                          <i class="bi bi-eye"></i>
                        </a>
                        {{#if (eq this.status 'draft')}}
                          <form action="/admin/assessments/{{this.id}}/delete" method="POST" class="d-inline ms-1"
                            onsubmit="return confirm('Delete this draft assessment? This cannot be undone.')">
                            <input type="hidden" name="return_to" value="/admin/projects/{{../project.id}}">
                            <button type="submit" class="btn btn-sm btn-outline-danger" title="Delete draft">
                              <i class="bi bi-trash"></i>
                            </button>
                          </form>
                        {{/if}}
                      </td>
                    </tr>
                  {{/each}}
                </tbody>
              </table>
            </div>
          {{else}}
            <div class="p-5 text-center text-muted">
              <i class="bi bi-clipboard-plus" style="font-size:3rem"></i>
              <p class="mt-3 mb-2">No assessments yet for this project.</p>
              <a href="/admin/projects/{{project.id}}/assessments/new" class="btn btn-primary">
                <i class="bi bi-plus-lg me-1"></i>Start Assessment
              </a>
            </div>
          {{/if}}
        </div>
      </div>
    </div>
  </div>
</div>
